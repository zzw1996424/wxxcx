/*!
 * Color Thief v2.0
 * by Lokesh Dhakar - http://www.lokeshdhakar.com
 *
 * Thanks
 * ------
 * Nick Rabinowitz - For creating quantize.js.
 * John Schulz - For clean up and optimization. @JFSIII
 * Nathan Spady - For adding drag and drop support to the demo page.
 *
 * License
 * -------
 * Copyright 2011, 2015 Lokesh Dhakar
 * Released under the MIT license
 * https://raw.githubusercontent.com/lokesh/color-thief/master/LICENSE
 *
 */
var CanvasImage=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(t){this.context.putImageData(t,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};/*!
 * quantize.js Copyright 2008 Nick Rabinowitz.
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 */
/*!
 * Block below copied from Protovis: http://mbostock.github.com/protovis/
 * Copyright 2010 Stanford Visualization Group
 * Licensed under the BSD License: http://www.opensource.org/licenses/bsd-license.php
 */
if(ColorThief.prototype.getColor=function(t,n){var r=this.getPalette(t,5,n),e=r[0];return e},ColorThief.prototype.getPalette=function(t,n,r){void 0===n&&(n=10),(void 0===r||1>r)&&(r=10);for(var e,o,a,i,u,c=new CanvasImage(t),s=c.getImageData(),f=s.data,v=c.getPixelCount(),h=[],g=0;v>g;g+=r)e=4*g,o=f[e+0],a=f[e+1],i=f[e+2],u=f[e+3],125>u||o>250&&a>250&&i>250||h.push([o,a,i]);var p=MMCQ.quantize(h,n),l=p?p.palette():null;return c.removeCanvas(),l},ColorThief.prototype.getColorFromUrl=function(t,n,r){sourceImage=document.createElement("img");var e=this;sourceImage.addEventListener("load",function(){var o=e.getPalette(sourceImage,5,r),a=o[0];n(a,t)}),sourceImage.src=t},ColorThief.prototype.getImageData=function(t,n){xhr=new XMLHttpRequest,xhr.open("GET",t,!0),xhr.responseType="arraybuffer",xhr.onload=function(){if(200==this.status){uInt8Array=new Uint8Array(this.response),t=uInt8Array.length,binaryString=Array(t);for(var t=0;t<uInt8Array.length;t++)binaryString[t]=String.fromCharCode(uInt8Array[t]);data=binaryString.join(""),base64=window.btoa(data),n("data:image/png;base64,"+base64)}},xhr.send()},ColorThief.prototype.getColorAsync=function(t,n,r){var e=this;this.getImageData(t,function(t){sourceImage=document.createElement("img"),sourceImage.addEventListener("load",function(){var t=e.getPalette(sourceImage,5,r),o=t[0];n(o,this)}),sourceImage.src=t})},!pv)var pv={map:function(t,n){var r={};return n?t.map(function(t,e){return r.index=e,n.call(r,t)}):t.slice()},naturalOrder:function(t,n){return n>t?-1:t>n?1:0},sum:function(t,n){var r={};return t.reduce(n?function(t,e,o){return r.index=o,t+n.call(r,e)}:function(t,n){return t+n},0)},max:function(t,n){return Math.max.apply(null,n?pv.map(t,n):t)}};var MMCQ=function(){function t(t,n,r){return(t<<2*c)+(n<<c)+r}function n(t){function n(){r.sort(t),e=!0}var r=[],e=!1;return{push:function(t){r.push(t),e=!1},peek:function(t){return e||n(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return e||n(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return e||n(),r}}}function r(t,n,r,e,o,a,i){var u=this;u.r1=t,u.r2=n,u.g1=r,u.g2=e,u.b1=o,u.b2=a,u.histo=i}function e(){this.vboxes=new n(function(t,n){return pv.naturalOrder(t.vbox.count()*t.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function o(n){var r,e,o,a,i=1<<3*c,u=Array(i);return n.forEach(function(n){e=n[0]>>s,o=n[1]>>s,a=n[2]>>s,r=t(e,o,a),u[r]=(u[r]||0)+1}),u}function a(t,n){var e,o,a,i=1e6,u=0,c=1e6,f=0,v=1e6,h=0;return t.forEach(function(t){e=t[0]>>s,o=t[1]>>s,a=t[2]>>s,i>e?i=e:e>u&&(u=e),c>o?c=o:o>f&&(f=o),v>a?v=a:a>h&&(h=a)}),new r(i,u,c,f,v,h,n)}function i(n,r){function e(t){var n,e,o,a,i,u=t+"1",s=t+"2",f=0;for(c=r[u];c<=r[s];c++)if(p[c]>g/2){for(o=r.copy(),a=r.copy(),n=c-r[u],e=r[s]-c,i=n>e?Math.max(r[u],~~(c-1-n/2)):Math.min(r[s]-1,~~(c+e/2));!p[i];)i++;for(f=l[i];!f&&p[i-1];)f=l[--i];return o[s]=i,a[u]=o[s]+1,[o,a]}}if(r.count()){var o=r.r2-r.r1+1,a=r.g2-r.g1+1,i=r.b2-r.b1+1,u=pv.max([o,a,i]);if(1==r.count())return[r.copy()];var c,s,f,v,h,g=0,p=[],l=[];if(u==o)for(c=r.r1;c<=r.r2;c++){for(v=0,s=r.g1;s<=r.g2;s++)for(f=r.b1;f<=r.b2;f++)h=t(c,s,f),v+=n[h]||0;g+=v,p[c]=g}else if(u==a)for(c=r.g1;c<=r.g2;c++){for(v=0,s=r.r1;s<=r.r2;s++)for(f=r.b1;f<=r.b2;f++)h=t(s,c,f),v+=n[h]||0;g+=v,p[c]=g}else for(c=r.b1;c<=r.b2;c++){for(v=0,s=r.r1;s<=r.r2;s++)for(f=r.g1;f<=r.g2;f++)h=t(s,f,c),v+=n[h]||0;g+=v,p[c]=g}return p.forEach(function(t,n){l[n]=g-t}),e(u==o?"r":u==a?"g":"b")}}function u(t,r){function u(t,n){for(var r,e=1,o=0;f>o;)if(r=t.pop(),r.count()){var a=i(c,r),u=a[0],s=a[1];if(!u)return;if(t.push(u),s&&(t.push(s),e++),e>=n)return;if(o++>f)return}else t.push(r),o++}if(!t.length||2>r||r>256)return!1;var c=o(t),s=0;c.forEach(function(){s++});var h=a(t,c),g=new n(function(t,n){return pv.naturalOrder(t.count(),n.count())});g.push(h),u(g,v*r);for(var p=new n(function(t,n){return pv.naturalOrder(t.count()*t.volume(),n.count()*n.volume())});g.size();)p.push(g.pop());u(p,r-p.size());for(var l=new e;p.size();)l.push(p.pop());return l}var c=5,s=8-c,f=1e3,v=.75;return r.prototype={volume:function(t){var n=this;return(!n._volume||t)&&(n._volume=(n.r2-n.r1+1)*(n.g2-n.g1+1)*(n.b2-n.b1+1)),n._volume},count:function(n){var r=this,e=r.histo;if(!r._count_set||n){var o,a,i,u=0;for(o=r.r1;o<=r.r2;o++)for(a=r.g1;a<=r.g2;a++)for(i=r.b1;i<=r.b2;i++)index=t(o,a,i),u+=e[index]||0;r._count=u,r._count_set=!0}return r._count},copy:function(){var t=this;return new r(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(n){var r=this,e=r.histo;if(!r._avg||n){var o,a,i,u,s,f=0,v=1<<8-c,h=0,g=0,p=0;for(a=r.r1;a<=r.r2;a++)for(i=r.g1;i<=r.g2;i++)for(u=r.b1;u<=r.b2;u++)s=t(a,i,u),o=e[s]||0,f+=o,h+=o*(a+.5)*v,g+=o*(i+.5)*v,p+=o*(u+.5)*v;r._avg=f?[~~(h/f),~~(g/f),~~(p/f)]:[~~(v*(r.r1+r.r2+1)/2),~~(v*(r.g1+r.g2+1)/2),~~(v*(r.b1+r.b2+1)/2)]}return r._avg},contains:function(t){var n=this,r=t[0]>>s;return gval=t[1]>>s,bval=t[2]>>s,!(r<n.r1||r>n.r2||gval<n.g1||gval>n.g2||bval<n.b1||bval>n.b2)}},e.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var n=this.vboxes,r=0;r<n.size();r++)if(n.peek(r).vbox.contains(t))return n.peek(r).color;return this.nearest(t)},nearest:function(t){for(var n,r,e,o=this.vboxes,a=0;a<o.size();a++)r=Math.sqrt(Math.pow(t[0]-o.peek(a).color[0],2)+Math.pow(t[1]-o.peek(a).color[1],2)+Math.pow(t[2]-o.peek(a).color[2],2)),(n>r||void 0===n)&&(n=r,e=o.peek(a).color);return e},forcebw:function(){var t=this.vboxes;t.sort(function(t,n){return pv.naturalOrder(pv.sum(t.color),pv.sum(n.color))});var n=t[0].color;n[0]<5&&n[1]<5&&n[2]<5&&(t[0].color=[0,0,0]);var r=t.length-1,e=t[r].color;e[0]>251&&e[1]>251&&e[2]>251&&(t[r].color=[255,255,255])}},{quantize:u}}();
